{"componentChunkName":"component---src-components-post-tsx","path":"/scheduled-jobs-work-queues-with-postgresql","result":{"pageContext":{"post":{"id":"cjn15y8740liw0175u3s707eh","title":"Scheduled Jobs & Work Queues With Postgresql","slug":"scheduled-jobs-work-queues-with-postgresql","published_at":"2019-10-08T04:00:00","created_at":"2018-10-09T03:26:12","encoded_html":"PHA+V2l0aCB0aGUgaGVscCBvZiBhbiBleHRlbnNpb24gb3IgdHdvLCBpdCdzIGVhc3kgdG8gdXNlIFBvc3RncmVzcWwgZm9yIHNjaGVkdWxlZCB3b3JrLjwvcD4KPHA+Rm9yIGV4YW1wbGUsIHVzaW5nIHRoZSBleHRlbnNpb25zIHBnX2Nyb24gYW5kIHBnc3FsLWh0dHAsIHlvdSBjYW4gaXNzdWUgYSBwb3N0IHJlcXVlc3QgdG8gYSB3ZWIgc2VydmljZSBhdCByZWd1bGFyIGludGVydmFsczo8L3A+CjxzY3JpcHQgc3JjPSJodHRwczovL2dpc3QuZ2l0aHViLmNvbS91bnNoaWZ0LzQ1YjlkY2U2OTViMjMwMmM5ZDc2YTQ5ZDFkNTYwODRiLmpzIj48L3NjcmlwdD4KPHA+Y3Jvbi5zY2hlZHVsZSBhY2NlcHRzIHR3byBhcmd1bWVudHMsICgxKSB0aGUgY3JvbiBzY2hlZHVsZSBleHByZXNzaW9uIGFuZCAoMikgdGhlIGRvbGxhci1xdW90ZWQgc3FsIHNjcmlwdCB0byBiZSBleGVjdXRlZC48L3A+CjxwPldoaWxlIGl0J3MgaW5hZHZpc2FibGUgdG8gYmUgaW50ZXJhY3Rpbmcgd2l0aCB3ZWIgc2VydmljZXMgaW4gcG9zdGdyZXNxbCB0cmlnZ2VycywgdXNpbmcgcGdzcWwtaHR0cCBpbiBhIFBvc3RncmVzcWwgY3JvbiBqb2IgaXMgYSBwZXJmZWN0IHVzZS1jYXNlLjwvcD4KPHA+Tm90ZSB0aGF0IHRoZSBhYm92ZSBjb2RlIHNuaXBwZXQgb25seSB3b3JrcyBhZnRlciBpbnN0YWxsaW5nIHBnc3FsLWh0dHAgYW5kIHBnX2Nyb246PC9wPgo8c2NyaXB0IHNyYz0iaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vdW5zaGlmdC8xMmNhODdlNmZkZDVlNjIxNzAzNTgxNGI2ZTg5ZmNhYS5qcyI+PC9zY3JpcHQ+CjxwPkZvciBwZ19jcm9uLCB5b3UnbGwgYWxzbyBuZWVkIHRvIGVkaXQgcG9zdGdyZXMuY29uZiBieSB1bmNvbW1lbnRpbmcgc2hhcmVkX3ByZWxvYWRfbGlicmFyaWVzIGFuZCBzZXR0aW5nIGl0IHRvICdwZ19jcm9uJyBhbmQgYWRkaW5nIGEgbGluZSB0aGF0IHNwZWNpZmllcyB0aGUgZGF0YWJhc2UgdGhhdCBzaG91bGQgYmUgdXNlZCBieSBwZ19jcm9uIChlLmcuLCBjcm9uLmRhdGFiYXNlX25hbWUgPSAncG9zdGdyZXMnKS4gPC9wPgo8cD5wZ19jcm9uIHVzZXMgdGhlIGZhbWlsaWFyIGNyb250YWIgc3ludGF4LiBZb3UgY2FuIHZpZXcgY3JvbiBqb2JzIGxpa2Ugc286PC9wPgo8cHJlPjxjb2RlIGNsYXNzPSJsYW5ndWFnZS1zcWwiPjxzcGFuIGNsYXNzPSJ0b2tlbiBrZXl3b3JkIj5zZWxlY3Q8L3NwYW4+IDxzcGFuIGNsYXNzPSJ0b2tlbiBvcGVyYXRvciI+Kjwvc3Bhbj4gPHNwYW4gY2xhc3M9InRva2VuIGtleXdvcmQiPmZyb208L3NwYW4+IGNyb248c3BhbiBjbGFzcz0idG9rZW4gcHVuY3R1YXRpb24iPi48L3NwYW4+am9iPHNwYW4gY2xhc3M9InRva2VuIHB1bmN0dWF0aW9uIj47PC9zcGFuPjwvY29kZT48L3ByZT4KPHA+IEFsc28gZG9uJ3QgZm9yZ2V0IHRoYXQgeW91IGNhbiBkZWJ1ZyB0aGUgb3V0cHV0IG9mIGNyb24gam9icyBhdCAvdmFyL2xpYi9wZ3NxbC8xMC9kYXRhL2xvZyAoYXNzdW1pbmcgdGhhdCB5b3UndmUgaW5zdGFsbGVkIHBvc3RncmVzcWwgMTApLjwvcD4=","excerpt":"With the help of an extension or two, it's easy to use Postgresql for scheduled work.","image":{"id":"nhxb5t4oodinrq9cqrg6y39gw","url":"static/cjn15y8740liw0175u3s707eh/kxHkAenZ_400x400.jpg"},"posts_tags":[{"tag":{"id":"4u88cmgqidmqnv2ucke8","name":"Posstgres"}}],"date":"10/08/2019","html":"<p>With the help of an extension or two, it's easy to use Postgresql for scheduled work.</p>\n<p>For example, using the extensions pg_cron and pgsql-http, you can issue a post request to a web service at regular intervals:</p>\n<script src=\"https://gist.github.com/unshift/45b9dce695b2302c9d76a49d1d56084b.js\"></script>\n<p>cron.schedule accepts two arguments, (1) the cron schedule expression and (2) the dollar-quoted sql script to be executed.</p>\n<p>While it's inadvisable to be interacting with web services in postgresql triggers, using pgsql-http in a Postgresql cron job is a perfect use-case.</p>\n<p>Note that the above code snippet only works after installing pgsql-http and pg_cron:</p>\n<script src=\"https://gist.github.com/unshift/12ca87e6fdd5e6217035814b6e89fcaa.js\"></script>\n<p>For pg_cron, you'll also need to edit postgres.conf by uncommenting shared_preload_libraries and setting it to 'pg_cron' and adding a line that specifies the database that should be used by pg_cron (e.g., cron.database_name = 'postgres'). </p>\n<p>pg_cron uses the familiar crontab syntax. You can view cron jobs like so:</p>\n<pre><code class=\"language-sql\"><span class=\"token keyword\">select</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> cron<span class=\"token punctuation\">.</span>job<span class=\"token punctuation\">;</span></code></pre>\n<p> Also don't forget that you can debug the output of cron jobs at /var/lib/pgsql/10/data/log (assuming that you've installed postgresql 10).</p>"}}}}